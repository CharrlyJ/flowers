<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Para mi amor 火</title>
    <!-- p5.js -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.js"></script>
    <style>
        body {
            margin: 0;
            background-color: #40E0D0;
            /* Azul turquesa */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        canvas {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <script>
        let fireworks = [];
        let gravity;
        let flowers = [];
        let timer = 0;
        let textAlpha = 0;
        let flowersStarted = false;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            // Modo HSB: Matiz(0-360), Saturaci贸n(0-100), Brillo(0-100), Alfa(0-1)
            colorMode(HSB, 360, 100, 100, 1);
            gravity = createVector(0, 0.2);
            stroke(255);
            strokeWeight(4);
            background(174, 71, 88); // Comienza con turquesa
        }

        function draw() {
            // Fondo turquesa #40E0D0 -> HSB(174, 71, 88)
            // Efecto de desvanecimiento para las estelas (siempre activo)
            background(174, 71, 88, 0.2);

            // L贸gica de Fuegos Artificiales (Siempre activa)
            if (random(1) < 0.08) {
                fireworks.push(new Firework());
            }

            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update();
                fireworks[i].show();
                if (fireworks[i].done()) {
                    fireworks.splice(i, 1);
                }
            }

            // Temporizador para las flores
            timer++;
            if (timer > 300 && !flowersStarted) { // ~5 segundos
                flowersStarted = true;
                initFlowers();
            }

            // L贸gica de Flores
            if (flowersStarted) {
                for (let flower of flowers) {
                    flower.grow();
                    flower.show();
                }

                // L贸gica de Texto
                if (flowers.every(f => f.grown)) {
                    drawText();
                }
            }
        }

        function drawText() {
            if (textAlpha < 255) {
                textAlpha += 2;
            }

            // Configuraci贸n de texto: Cursiva (Italic), Arial, 50, Blanco
            textFont('Arial');
            textStyle(ITALIC);
            textSize(50); // Tama帽o aumentado para visibilidad en pantalla completa
            textAlign(CENTER, CENTER);
            noStroke();
            fill(0, 0, 100, textAlpha / 255); // Blanco en HSB es (0,0,100)
            text("Amor, cuatro letras tan sencillas わ", width / 2, height / 2 - 200);
        }

        function initFlowers() {
            // Crear un ramo
            let centerX = width / 2;
            let bottomY = height;

            // Agregar Girasoles (Amarillo)
            // Centro (M谩s alto)
            let centerFlower = new Flower(centerX, bottomY, 'SUNFLOWER', 0, 420);
            centerFlower.addExtraBloom(0.6); // Flor al 60% de altura
            flowers.push(centerFlower);

            // Primera capa (Separaci贸n m谩s amplia, Menor altura)
            let leftFlower = new Flower(centerX - 50, bottomY, 'SUNFLOWER', -12, 320);
            leftFlower.addExtraBloom(0.4); // Flor al 60% de altura
            flowers.push(leftFlower);

            let rightFlower = new Flower(centerX + 50, bottomY, 'SUNFLOWER', 12, 320);
            rightFlower.addExtraBloom(0.4); // Flor al 60% de altura
            flowers.push(rightFlower);

            // Segunda capa (M谩s ancha, M谩s baja)
            flowers.push(new Flower(centerX - 110, bottomY + 20, 'SUNFLOWER', -25, 250));
            flowers.push(new Flower(centerX + 110, bottomY + 20, 'SUNFLOWER', 25, 250));
        }

        class Firework {
            constructor() {
                this.firework = new Particle(random(width), height, true);
                this.exploded = false;
                this.particles = [];
            }

            done() {
                return this.exploded && this.particles.length === 0;
            }

            update() {
                if (!this.exploded) {
                    this.firework.applyForce(gravity);
                    this.firework.update();
                    if (this.firework.vel.y >= 0) {
                        this.exploded = true;
                        this.explode();
                    }
                }

                for (let i = this.particles.length - 1; i >= 0; i--) {
                    this.particles[i].applyForce(gravity);
                    this.particles[i].update();
                    if (this.particles[i].done()) {
                        this.particles.splice(i, 1);
                    }
                }
            }

            explode() {
                for (let i = 0; i < 100; i++) {
                    const p = new Particle(this.firework.pos.x, this.firework.pos.y, false);
                    this.particles.push(p);
                }
            }

            show() {
                if (!this.exploded) {
                    this.firework.show();
                }
                for (let i = 0; i < this.particles.length; i++) {
                    this.particles[i].show();
                }
            }
        }

        class Particle {
            constructor(x, y, isFirework) {
                this.pos = createVector(x, y);
                this.isFirework = isFirework;
                this.lifespan = 255;
                this.hu = random(360);

                if (this.isFirework) {
                    this.vel = createVector(0, random(-16, -10)); // Salto m谩s alto
                } else {
                    this.vel = p5.Vector.random2D();
                    this.vel.mult(random(2, 10));
                }
                this.acc = createVector(0, 0);
            }

            applyForce(force) {
                this.acc.add(force);
            }

            update() {
                if (!this.isFirework) {
                    this.vel.mult(0.9);
                    this.lifespan -= 4;
                }
                this.vel.add(this.acc);
                this.pos.add(this.vel);
                this.acc.mult(0);
            }

            done() {
                return this.lifespan < 0;
            }

            show() {
                colorMode(HSB);
                if (!this.isFirework) {
                    strokeWeight(2);
                    stroke(this.hu, 255, 255, this.lifespan / 255);
                } else {
                    strokeWeight(4);
                    stroke(this.hu, 255, 255);
                }
                point(this.pos.x, this.pos.y);
            }
        }

        class Flower {
            constructor(x, y, type, angleDeg, targetHeight) {
                this.x = x;
                this.y = y;
                this.type = type; // 'ROSE' (Rosa) o 'SUNFLOWER' (Girasol)
                this.angle = angleDeg;
                this.maxStemHeight = targetHeight || random(300, 400);
                this.currentHeight = 0;
                this.bloomSize = 0;
                this.maxBloomSize = type === 'ROSE' ? 60 : 120; // Aumentado de 80 a 120
                this.grown = false;
                this.extraBlooms = [];
            }

            addExtraBloom(heightRatio) {
                this.extraBlooms.push({
                    heightRatio: heightRatio,
                    bloomSize: 0,
                    maxBloomSize: this.maxBloomSize * 0.9, // M谩s peque帽a que la flor principal
                    grown: false
                });
            }

            grow() {
                // Crecer Tallo Principal
                if (this.currentHeight < this.maxStemHeight) {
                    this.currentHeight += 2;
                } else if (this.bloomSize < this.maxBloomSize) {
                    this.bloomSize += 0.5;
                } else {
                    this.grown = true;
                }

                // Crecer Flores Extra
                for (let extra of this.extraBlooms) {
                    let attachH = this.maxStemHeight * extra.heightRatio;
                    // Comenzar a crecer flor extra cuando el tallo pasa su altura
                    if (this.currentHeight > attachH) {
                        if (extra.bloomSize < extra.maxBloomSize) {
                            extra.bloomSize += 0.4;
                        } else {
                            extra.grown = true;
                        }
                    }
                }
            }

            show() {
                push();
                translate(this.x, this.y);
                rotate(radians(this.angle)); // Rotaci贸n suave para efecto de ramo

                // Dibujar Tallo Principal
                stroke(120, 100, 40); // Marr贸n verdoso HSB
                strokeWeight(6);
                line(0, 0, 0, -this.currentHeight);

                // Dibujar Flores Extra en el tallo
                for (let extra of this.extraBlooms) {
                    let attachH = this.maxStemHeight * extra.heightRatio;
                    if (this.currentHeight > attachH) {
                        push();
                        translate(0, -attachH);
                        // Sin rotaci贸n, est谩 en el tallo.

                        noStroke();
                        this.drawBloom(extra.bloomSize);
                        pop();
                    }
                }

                // Dibujar Flor Principal
                translate(0, -this.currentHeight);
                noStroke();
                this.drawBloom(this.bloomSize);

                pop();
            }

            drawBloom(size) {
                if (size <= 0) return;

                if (this.type === 'ROSE') {
                    // Color Rosa: Rojo (Matiz ~0 o ~350, Sat 100, Bri 100)
                    fill(350, 90, 90);
                    // Simular capas de rosa
                    ellipse(0, 0, size, size);
                    fill(350, 100, 70);
                    ellipse(0, 0, size * 0.7, size * 0.7);
                    fill(350, 100, 50);
                    ellipse(0, 0, size * 0.4, size * 0.4);

                } else if (this.type === 'SUNFLOWER') {
                    // P茅talos de Girasol: Amarillo (Matiz ~50)
                    fill(50, 100, 100);
                    for (let i = 0; i < 12; i++) {
                        push();
                        rotate(radians(i * 30));
                        ellipse(0, size * 0.4, size * 0.25, size * 0.8);
                        pop();
                    }
                    // Centro de Girasol: Marr贸n Oscuro
                    fill(25, 80, 40);
                    ellipse(0, 0, size * 0.5, size * 0.5);
                }
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>

</html>